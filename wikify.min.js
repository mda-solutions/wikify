(function(e){e.fn.wikify=function(t){function u(t,n){function r(e){var r=o(e,t);n.set("content.title",t);n.set("content.text",r)}e.getJSON("http://es.wikipedia.org/w/api.php?action=parse&format=json&callback=?",{page:t,prop:"text|images",uselang:"es"},r)}var n=e(this).text();var r=t.definitions;var i=n.split(" ");var s=e(this);e("body").append('<div id="wikify_tmp_container"></div>');var o=function(t,n){var r=t.parse.text["*"];var i=e('<div style="display:none;">'+r+"</div>");var s=i.find('li:contains("REDIRECT") a').text();if(s!=""){u(s);return}e("#wikify_tmp_container").html(i);var o=null;var a=null;if(t.parse.images.length>=1){image=t.parse.images[0];var f=e("#wikify_tmp_container IMG");a=e(f[0]).attr("src")}var l=e("#wikify_tmp_container P");var c="_";var h=new RegExp(c,"g");var p=n.replace(h," ");e.each(l,function(t,n){var r=e(n);var i=r.text().search(p);if(i>-1&&r.text().length>100){o=r.text();return false}});var d=a!=null?'<div><img src="http:'+a+'"/>':"";var v=o!=null?"<div>"+o+"</div>":"";e("#wikify_tmp_container").html("");return v};e.each(i,function(e,t){if(r.indexOf(t)!=-1){oldhtml=s.html();var n=oldhtml.replace(t,'<a style="cursor:pointer" class="wikify_link" href="javascript:void(0)">'+t+"</a>");s.html(n)}});e("a.wikify_link").qtip({content:{text:function(t,n){var r=e(this).text();u(r,n);return"Loading..."}}})}})(jQuery)